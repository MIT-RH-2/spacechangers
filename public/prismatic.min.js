!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).prismatic={})}(this,(function(t){"use strict";let e=t=>{if(0!==mlWorld.length)throw new Error("Volume already exists");let e=mlWorld.createVolume(.1,.1,.1);if(!e)throw new Error("Volume was not created");t._volume=e;const r=window.mlWorld.viewportHeight/2+window.mlWorld.viewPortPositionTopLeft.y,i=(new DOMMatrix).translate(0,r,0);return e.transformVolumeRelativeToHostVolume(i),e.setSize(window.mlWorld.stageSize.x,window.mlWorld.stageSize.y,window.mlWorld.stageSize.z),e.visible=!0,e.addEventListener("mlanimation",t=>{if("animationEnd"===t.type&&t.model&&t.model.htmlElement){let e=t.model.htmlElement,r=new CustomEvent("model-animation-end",{detail:{animationName:t.animationName}});e.dispatchEvent(r)}}),e.addEventListener("mltransformanimation",(function(t){if(t.node&&t.node.htmlElement){let e=t.node.htmlElement,r=new CustomEvent("transform-animation-end",{detail:{track:t.track,type:t.type}});e.dispatchEvent(r)}})),e.addEventListener("mlextraction",t=>{if(t.targetNode&&t.targetNode.htmlElement){t.targetNode.htmlElement.dispatchEvent(new Event("mlextraction"))}}),e.addEventListener("mlraycast",t=>{if(t.hitData.targetNode&&t.hitData.targetNode.htmlElement){let e=t.hitData.targetNode.htmlElement,r=t.type.replace(/Totem/g,"Control"),i=e._model?e._model:e._quad;if(i&&i.visible){let i="";if(r.search(/control/i)>=0){if(i="control","nodeOnControlEnter"===r){let t=new MouseEvent("mouseover",{view:window,bubbles:!0,cancelable:!0});e.dispatchEvent(t)}else if("nodeOnControlExit"===r){let t=new MouseEvent("mouseout",{view:window,bubbles:!0,cancelable:!0});e.dispatchEvent(t)}}else r.search(/head/i)>=0&&(i="headpos");if("quadNode"===t.hitData.type||"modelNode"===t.hitData.type){let a=new CustomEvent("node-raycast",{detail:{inputType:i,type:r,hitData:t.hitData}});e.dispatchEvent(a)}}}}),e};const r=150,i=window.mlWorld?window.mlWorld.viewportWidth/window.innerWidth:0;let a=t=>Math.fround(t*i);class o extends HTMLElement{connectedCallback(){window.mlWorld?(0===mlWorld.length&&(window.mlWorld.resetStageExtent(),e(this)),this.requestStageExtents()):this.dispatchEvent(new ErrorEvent("error",{error:new Error("Unable to render 3D content on this device."),message:"No mixed-reality browser detected.",bubbles:!0}))}requestStageExtents(){if(!this.hasAttribute("extents"))return void console.warn("No stage extents attribute provided.");let t={top:0,right:0,bottom:0,left:0,front:0,back:0};this.getAttribute("extents").toLowerCase().split(/;/).forEach(e=>{let r=e.split(":");if(2===r.length){let e=r[0].trim(),i=parseFloat(r[1]);if(i){let o=r[1].trim().toString().replace(/[^A-Za-z]/g,"").toLowerCase();"cm"===o?i*=.01:"px"===o&&(i=a(i)),t[e]=i}}}),mlWorld[0].visible=!1,mlWorld.update();let e=new MLStageExtent(t.top,t.right,t.bottom,t.left,t.front,t.back);window.mlWorld.setStageExtent(e).then(t=>{"granted"==t.state&&this.dispatchEvent(new Event("stage-granted")),"denied"==t.state&&(this.dispatchEvent(new Event("stage-denied")),console.error("Permission requesting new stage's extents has not been granted."))}).catch(t=>{console.error(`There was an error requesting the new stage's extents. Error: ${t.message}`)}).finally(()=>{mlWorld[0].visible=!0})}get extents(){return this.getAttribute("extents")}set extents(t){this.getAttribute("extents")!==t.toString()&&this.setAttribute("extents",t)}}window.customElements.define("ml-stage",o);let s=t=>{let e=0;if(parseFloat(t)){let r=t.toString().replace(/[^A-Za-z]/g,"").toLowerCase();e="cm"===r?parseFloat(t)/.026458333:"mm"===r?parseFloat(t)/.026458333/10:parseFloat(t)}return e},n=t=>{if(!t)return!1;let e=window.getComputedStyle(t,"");return"none"!=e.display&&("hidden"!=e.visibility&&!t.hidden)},l=(t,e=!1)=>{t.skipRaycast=e},d=(t,e)=>{if(e&&t._transform){let r=e.trim().replace(/[^\d.-]+/g," ").split(" ").map(parseFloat).filter(t=>!isNaN(t));t._transform.setLocalScale(new Float32Array(r))}},c=t=>t*(Math.PI/180),m=(t,e)=>{if(e){let r=(t=>{let e=Math.cos(t[0]/2),r=Math.cos(t[1]/2),i=Math.cos(t[2]/2),a=Math.sin(t[0]/2),o=Math.sin(t[1]/2),s=Math.sin(t[2]/2);return[a*r*i-e*o*s,e*o*i+a*r*s,e*r*s-a*o*i,e*r*i+a*o*s]})((t=>{let e=t.trim().replace(/[^\d.-]+/g," ").split(" ").map(parseFloat).filter(t=>!isNaN(t));if(t.toLowerCase().split("deg").length-1>0&&(e=e.map(t=>c(t))),e&&3===e.length)return e;console.error("Invalid values used for rotation attribute.")})(e));r&&t._transform&&t._transform.setLocalRotation(new Float32Array(r))}},h=(t,e,r)=>{if(e){let i=(t=>{let e={},r=["name","paused","iterations"];if(t.split(/;|,/).forEach((t,i)=>{let a=t.split(":");2===a.length?e[a[0].trim()]=a[1].trim():1===a.length&&(e[r[i]]=a[0].trim())}),e.name)return e.paused?e.paused="false"!==e.paused&&"no"!==e.paused&&"0"!==e.paused&&""!==e.paused:(e.paused=!1,console.warn("Invalid paused value for animation attribute. Default value of false used.")),isNaN(parseInt(e.iterations))?(e.iterations=-1,console.warn("Invalid iterations value for model-animation attribute. Default value of -1 used.")):e.iterations=parseInt(e.iterations),e;console.error("No animation name found in animation attribute.")})(e);i&&t._model&&(t._model.playAnimation(i.name,i.paused,i.iterations),isNaN(parseInt(r))||(t._model.animationPlaybackSpeed=Number(r)))}},u=(t,e=!1)=>{let r={};if(t.toLowerCase().split(/;/).forEach(t=>{let i=t.split(":");if(2===i.length){let t=i[0].trim(),a=i[1].trim();if("offset"===t)r[t]=a.replace(/\r?\n|\r|\t|,/gm," ").replace(/  +/g," ").split(" ");else{let i=a.match(/[+-]?\d+(\.\d+)?/g);if(i&&(r[t]=i.map(t=>parseFloat(t))),r[t])if(1===r[t].length)r[t]=r[t][0],!e||"angle"!==t&&"rate"!==t||isNaN(a)&&!isNaN(parseFloat(a))&&-1!==a.indexOf("deg")&&(r[t]=c(parseFloat(a)));else if("angles"===t){let e=r[t].reduce((t,e)=>t+(0===e),0);a.split("deg").length-1>=3-e&&(r[t]=r[t].map(t=>c(t)))}}}}),r.axes&&3===r.axes.length||r.angles&&3===r.angles.length||r.offset&&3===r.offset.length)return isNaN(r.duration)&&(r.duration=60,console.warn("No duration value in animation attribute. Default value of 60 seconds used.")),Number.isInteger(r.track)||(r.track=0,console.warn("No track value in animation attribute. Default value of 0 used.")),e&&r.hasOwnProperty("rate")&&!isNaN(parseFloat(r.rate))&&(r.angle=r.rate,delete r.rate),e&&isNaN(r.angle)&&(r.angle=1.0472,console.warn("No angle rate value in spin animation attribute. Default value of 60 degrees per second used.")),r;console.error("Invalid axes value used for animation attribute.")},g=(t,e)=>{if(e){let r=u(e,!0);r&&(t._transform.spin(new Float32Array(r.axes),r.angle,r.duration,r.track),t._transform.addMoveCallback(r.track))}},b=(t,e)=>{if(e){let r=u(e);r&&(t._transform.scaleTo(new Float32Array(r.axes),r.duration,r.track),t._transform.addMoveCallback(r.track))}},f=(t,e)=>{if(e){let r=u(e);r&&(t._transform.scaleBy(new Float32Array(r.axes),r.duration,r.track),t._transform.addMoveCallback(r.track))}},w=t=>{let e=a(t)-window.mlWorld.viewportWidth/2;return Math.fround(e)},v=t=>{let e=window.mlWorld.viewportHeight/2-a(t);return Math.fround(e)},p=(t=r)=>{let e=a(t);return Math.fround(e)},_=(t,e)=>{let r=y(e);return[isNaN(parseFloat(r[0]))?t._mainTransform.getLocalPosition()[0]:w(r[0])+(window.mlWorld.stageExtent.left-window.mlWorld.stageExtent.right)/2,isNaN(parseFloat(r[1]))?t._mainTransform.getLocalPosition()[1]:v(r[1])+(window.mlWorld.stageExtent.bottom-window.mlWorld.stageExtent.top)/2,isNaN(parseFloat(r[2]))?t._mainTransform.getLocalPosition()[2]:p(r[2])+(window.mlWorld.stageExtent.back-window.mlWorld.stageExtent.front)/2]},y=t=>{let e,r,i;switch(t[0]){case"left":e=0;break;case"middle":case"center":e=window.outerWidth/2;break;case"right":e=window.outerWidth;break;default:e=isNaN(parseFloat(t[0]))?void 0:parseFloat(t[0])}switch(t[1]){case"top":r=0;break;case"middle":case"center":r=window.outerHeight/2;break;case"bottom":r=window.outerHeight;break;default:r=isNaN(parseFloat(t[1]))?void 0:parseFloat(t[1])}return[e,r,i=isNaN(parseFloat(t[2]))?void 0:parseFloat(t[2])]},A=(t,e)=>{if(e){let r=u(e);if(r){let e;r.offset?e=_(t,r.offset):r.axes&&(e=_(t,r.axes)),t._transform.moveTo(new Float32Array(e),r.duration,r.track),t._transform.addMoveCallback(r.track)}}},x=(t,e)=>{if(e){let r=u(e);if(r&&r.axes){let e=r.axes.map(a);t._transform.moveBy(new Float32Array(e),r.duration,r.track),t._transform.addMoveCallback(r.track)}else console.error(`Invalid axis values used for animation attribute. ${t.id}`)}},E=(t,e)=>{if(e){let r=u(e);r&&(t._transform.rotateToAngles(new Float32Array(r.angles),r.duration,r.track),t._transform.addMoveCallback(r.track))}},S=(t,e)=>{if(e){let r=u(e);r&&(t._transform.rotateByAngles(new Float32Array(r.angles),r.duration,r.track),t._transform.addMoveCallback(r.track))}},W=t=>({width:a(t.clientWidth),height:a(t.clientHeight),breadth:t.breadth?a(t.breadth):a(Math.max(t.clientWidth,t.clientHeight))}),F=t=>{t&&t.addEventListener("mlextraction",L,!1)},k=t=>{t&&t.removeEventListener("mlextraction",L,!1)},L=t=>{t.isTrusted&&window.addEventListener("click",t=>t.stopPropagation(),{once:!0,capture:!0});let e=t.target,r=e._model?e._model:e._quad;if(r&&r.visible){e._originalScale&&e._mainTransform.setLocalScale(new Float32Array([e._originalScale[0],e._originalScale[1],e._originalScale[2]])),e._originalPosition&&e._mainTransform.setLocalPosition(new Float32Array([e._originalPosition[0],e._originalPosition[1],e._originalPosition[2]]));let t,i,a,[o,s,n]=e._mainTransform.getLocalPosition(),[l,d,c]=e._transform.getLocalPosition(),[m,h,u]=r.getLocalScale(),[g,b,f]=e._mainTransform.getLocalScale();e._model?[t,i,a]=[e._resource.width*m*g,e._resource.height*h*b,e._resource.depth*u*f]:e._quad&&([t,i,a]=[m*g,h*b,u*f]);let w,[v,p,_]=[t,i,a];if(e.extractedSize){if([v,p,_]=e.extractedSize.replace(/  +/g," ").split(" ").map(parseFloat),isNaN(_)&&(_=e._quad?1e-4:Math.min(v,p)),isNaN(v)||isNaN(p)||isNaN(_))return void console.warn("Invalid value used for extracted-size attribute.");let r=v/t,o=p/i,s=_/a,n=Math.min(t/v,i/p);n<1&&(r*=n,o*=n,s*=n,[v,p,_]=[t*r,i*o,a*s],e.extractedScale=1/n),e._mainTransform.setLocalScale(new Float32Array([g*r,b*o,f*s]))}e.dispatchEvent(new Event("extracting-node")),e._mainTransform.setLocalPosition(new Float32Array([0,0,0])),e._transform.setLocalPosition(new Float32Array([0,0,0])),e._model?w=c+n+e._resource.depth*e._model.getLocalScale()[2]:e._quad&&(w=c+n);let y=(new DOMMatrix).translate(l+o+(window.mlWorld.stageExtent.right-window.mlWorld.stageExtent.left)/2,d+s+(window.mlWorld.viewportHeight/2+window.mlWorld.viewPortPositionTopLeft.y)+(window.mlWorld.stageExtent.top-window.mlWorld.stageExtent.bottom)/2,w+(window.mlWorld.stageExtent.front-window.mlWorld.stageExtent.back)/2);T(e,y,{width:v,height:p,breadth:_}),e._mainTransform.setLocalScale(new Float32Array([g,b,f])),e._mainTransform.setLocalPosition(new Float32Array([o,s,n])),e._transform.setLocalPosition(new Float32Array([l,d,c]))}},T=(t,e,r)=>{let i=t.extractedScale?t.extractedScale:1,a=t.extractedLink?t.extractedLink:window.location.href;if(t.animation&&!t.extractedSize){let{width:e,height:i,breadth:a}=W(t);r.width=e,r.height=i,r.breadth=a}if(t._transform.getLocalRotation().some(t=>0!==t)){let e=(t=>{let e=2*Math.acos(t[3]),r=t[0]*e,i=t[1]*e,a=t[2]*e;if(1-t[3]*t[3]>=1e-6){let o=Math.sqrt(1-t[3]*t[3]);r=t[0]/o*e,i=t[1]/o*e,a=t[2]/o*e}return[r,i,a]})(t._transform.getLocalRotation());if(e[0]){let t=Math.abs(Math.sin(e[0]))*r.height+Math.abs(Math.cos(e[0]))*r.breadth,i=Math.abs(Math.sin(e[0]))*r.breadth+Math.abs(Math.cos(e[0]))*r.height;r.breadth=Math.max(r.breadth,t),r.height=Math.max(r.height,i)}if(e[1]){let t=Math.abs(Math.sin(e[1]))*r.breadth+Math.abs(Math.cos(e[1]))*r.width,i=Math.abs(Math.sin(e[1]))*r.width+Math.abs(Math.cos(e[1]))*r.breadth;r.width=Math.max(r.width,t),r.breadth=Math.max(r.breadth,i)}if(e[2]){let t=Math.abs(Math.sin(e[2]))*r.height+Math.abs(Math.cos(e[2]))*r.width,i=Math.abs(Math.sin(e[2]))*r.width+Math.abs(Math.cos(e[2]))*r.height;r.width=Math.max(r.width,t),r.height=Math.max(r.height,i)}}t._mainTransform.extractContent({scale:i,transform:e,doIt:"auto",origin_url:a,width:r.width+1e-4,height:r.height+1e-4,breadth:r.breadth+1e-4}),t.dispatchEvent(new Event("node-extracted"))},N=t=>{t.style.cursor="-webkit-grab",t.addEventListener("mouseover",P),t.addEventListener("mouseout",z)},M=t=>{t.style.cursor="auto",t.removeEventListener("mouseover",P),t.removeEventListener("mouseout",z)},P=t=>{clearTimeout(t.target._mouseoverTimeoutId),t.target._mouseoverTimeoutId=setTimeout(()=>q(t),250)},q=t=>{let e=t.target,r=e._model?e._model:e._quad,i=mlWorld[0];i&&i.visible&&r&&r.visible&&"mouseover"!==e._lastHoverEvent&&("function"==typeof i.triggerControlHaptic&&i.triggerControlHaptic("VIBE_TICK"),e._originalScale||(e._originalScale=e._mainTransform.getLocalScale()),e._mainTransform.scaleTo(new Float32Array([1.25*e._originalScale[0],1.25*e._originalScale[1],1.25*e._originalScale[2]]),.1,-1),e._originalPosition||(e._originalPosition=e._mainTransform.getLocalPosition()),e._mainTransform.moveTo(new Float32Array([e._originalPosition[0],e._originalPosition[1],e._originalPosition[2]+.02]),.1,-2),e._lastHoverEvent="mouseover",e._lastHoverEventHtml=t.isTrusted)},z=t=>{clearTimeout(t.target._mouseoutTimeoutId),t.target._mouseoutTimeoutId=setTimeout(()=>C(t),250)},C=t=>{let e=t.target,r=e._model?e._model:e._quad,i=mlWorld[0];if(r&&"mouseover"===e._lastHoverEvent){if(e._lastHoverEventHtml&&!t.isTrusted)return;"function"==typeof i.triggerControlHaptic&&i.triggerControlHaptic("VIBE_FORCE_DWELL"),e._originalPosition&&e._mainTransform.moveTo(new Float32Array([e._originalPosition[0],e._originalPosition[1],e._originalPosition[2]]),.1,-1),e._originalScale&&e._mainTransform.scaleTo(new Float32Array([e._originalScale[0],e._originalScale[1],e._originalScale[2]]),.1,-2),e._lastHoverEvent="mouseout",e._lastHoverEventHtml=t.isTrusted}},H=t=>{delete t._originalPosition,delete t._originalScale},O=t=>{if(t._mainTransform){let{positionX:e,positionY:r,positionZ:i}=(t=>{let e=t.getBoundingClientRect();return{positionX:w(e.left+t.clientWidth/2)+(window.mlWorld.stageExtent.left-window.mlWorld.stageExtent.right)/2,positionY:v(e.top+t.clientHeight/2)+(window.mlWorld.stageExtent.bottom-window.mlWorld.stageExtent.top)/2,positionZ:p(t.zOffset)+(window.mlWorld.stageExtent.back-window.mlWorld.stageExtent.front)/2}})(t);t._mainTransform.setLocalPosition(new Float32Array([e,r,i])),H(t)}},I=t=>{if(void 0===t._mutationObserver){t._mutationObserver=new MutationObserver(e=>{e.forEach(e=>{let r=e.target._model?e.target._model:e.target._quad;r&&(n(t)||!r.visible||t.hasAttribute("visibility")?!n(t)||r.visible||t.hasAttribute("visibility")||(r.visible=!0):r.visible=!1,O(e.target))})});let e={attributeOldValue:!0,attributes:!0,attributeFilter:["style","class"]};t._mutationObserver.observe(t,e)}},$=t=>{if(t._model?t._model:t._quad){0!==t.clientWidth&&0!==t.clientHeight||(t=>{!n(t)||0!==t.clientWidth&&0!==t.clientHeight||((t=>{t._mutationObserver&&(t._mutationObserver.disconnect(),delete t._mutationObserver)})(t),0===t.clientWidth&&(t.clientHeight>0?t.style.width=`${t.clientHeight}px`:t.style.width="inherit",0===t.clientWidth&&(t.style.width="auto"),0===t.clientWidth&&(t.style.width=`${t.parentElement.clientWidth}px`)),0===t.clientHeight&&(t.style.height="inherit",0===t.clientHeight&&(t.style.height="auto"),0===t.clientHeight&&t.clientWidth>0&&(t.style.height=`${t.clientWidth}px`)),I(t))})(t);let{width:e,height:r,breadth:i}=W(t);if(0===e||0===r||0===i)console.warn(`At least one of the node's dimension is not specified.  Dimensions are specified using CSS width/height properties: ${t.id}.`);else if(t._model)if(!t.hasAttribute("fill")||""!==t.getAttribute("fill")&&"true"!==t.getAttribute("fill")){let a;a=t.breadth?Math.min(e/t._resource.width,r/t._resource.height,i/t._resource.depth):Math.min(e/t._resource.width,r/t._resource.height),t._model.setLocalScale(new Float32Array([a,a,a])),t._model.setAnchorPosition(new Float32Array([t._resource.center.x,t._resource.center.y,t._resource.center.z]))}else t._model.setLocalScale(new Float32Array([e/t._resource.width,r/t._resource.height,i/t._resource.depth]));else t._quad&&(t._quad.setLocalScale(new Float32Array([e,r,0])),t._quad.setLocalPosition(new Float32Array([-e/2,-r/2,0])))}},B=t=>{let e={};if(t.split(/;/).forEach(t=>{let r=t.split(":");2===r.length&&(e[r[0].trim()]=r[1].trim())}),e["color-intensity"]||e["bloom-strength"])return e;console.error("Invalid values used for environment lighting attribute. Make sure to specify color-intensity or bloom-strength.")},R=(t,e)=>{let r=mlWorld[0],i=t._model;if(e.extractable&&("false"!==e.extractable?(N(t),F(t)):(M(t),k(t))),i){if(e.color?i.color=e.color:""===e.color&&(i.color="#FFFFFF"),e["environment-lighting"]){let t=B(e["environment-lighting"]);t["color-intensity"]&&(i.colorIntensity=t["color-intensity"]),t["bloom-strength"]&&(i.bloomStrength=t["bloom-strength"],r.bloomStrength=t["bloom-strength"])}e.raycast&&l(i,!("true"===e.raycast)),e.visibility&&(i.visible=n(t)&&!("hidden"===e.visibility)),e["model-scale"]&&(d(t,e["model-scale"]),H(t)),e.scale&&(d(t,e.scale),H(t)),e.rotation&&m(t,e.rotation),e["model-animation"]&&h(t,e["model-animation"],t.animationSpeed),e["model-animation-speed"]&&((t,e)=>{!isNaN(parseInt(e))&&t._model&&(t._model.animationPlaybackSpeed=Number(e))})(t,e["model-animation-speed"]),e.spin&&g(t,e.spin),e["scale-to"]&&(b(t,e["scale-to"]),H(t)),e["scale-by"]&&(f(t,e["scale-by"]),H(t)),e["move-to"]&&A(t,e["move-to"]),e["move-by"]&&(x(t,e["move-by"]),H(t)),e["rotate-to-angles"]&&E(t,e["rotate-to-angles"]),e["rotate-by-angles"]&&S(t,e["rotate-by-angles"]),(e.breadth||e["z-offset"])&&($(t),O(t))}},D=(t,e)=>{let r=mlWorld[0];if(t._model||(t._model=r.createModel(),t._model.visible=!1,t._model.htmlElement=t),t._model.triggerable=!0,t._resource=e.resource,t._model.setModelResource(t._resource),isNaN(parseFloat(t._resource.width))||!isFinite(t._resource.width))throw new Error(`Set model resource failed: ${t.src}`);t.dispatchEvent(new Event("resource-loaded")),t._model.shader=e.shader,t._transform||(t._transform=r.createTransform(),t._transform.htmlElement=t,t._transform.addChild(t._model),t._mainTransform=r.createTransform(),t._mainTransform.addChild(t._transform),r.addChild(t._mainTransform)),t._kmat&&t._textures&&(t._model.textures=t._textures,t._model.kmat=t._kmat),$(t),O(t);let i={trigger:t.getAttribute("trigger"),color:t.getAttribute("color"),raycast:t.getAttribute("raycast"),"model-scale":t.getAttribute("model-scale"),scale:t.getAttribute("scale"),rotation:t.getAttribute("rotation"),"rotate-to-angles":t.getAttribute("rotate-to-angles"),"rotate-by-angles":t.getAttribute("rotate-by-angles"),"model-animation":t.getAttribute("model-animation"),spin:t.getAttribute("spin"),"scale-to":t.getAttribute("scale-to"),"scale-by":t.getAttribute("scale-by"),"move-to":t.getAttribute("move-to"),"move-by":t.getAttribute("move-by"),"environment-lighting":t.getAttribute("environment-lighting")};R(t,i),window.mlWorld.update(),t.dispatchEvent(new Event("model-displayed"))},j=async t=>{mlWorld[0];if(t.hasAttribute("materials")){let e=(t=>{let e={};if(t.split(/;/).forEach(t=>{let r=t.split(":");2===r.length&&("textures"===r[0].trim()?e[r[0].trim()]=r[1].trim().replace(/\r?\n|\r|\t|,/gm," ").replace(/  +/g," ").split(/ /).filter(t=>t.trim()):e[r[0].trim()]=r[1].trim())}),e.kmat&&e.textures&&e.textures.length>0)return e;console.error("Invalid values used for materials attribute. No materials loaded.")})(t.getAttribute("materials"));e&&(t._textures=await(t=>{return Promise.all(t.map((function(t){return new Promise((e,r)=>{let i=new Image;i.onload=()=>{e(mlWorld[0].createTexture(i,t))},i.onerror=()=>{r(new Error(`Problem loading texture: ${t}.`))},i.src=t})})))})(e.textures),t._kmat=await(async t=>{let e=await fetch(t);if(e.ok){let r=await e.arrayBuffer();return mlWorld[0].createKMat(r,t)}return Promise.reject(new Error(`Problem creating KMat file: ${t}`))})(e.kmat),t._textures.forEach(e=>{t._kmat.addDependentResource(e)}))}t.dispatchEvent(new Event("mesh-readytoload"));let e=await(async(t,e)=>{if(!new RegExp(/\.(fbx|glb)(\?|#|$)/i).test(e)){let t=new Error(`Invalid model file extension: ${e}. Only FBX and GLB are supported at the moment.`);return Promise.reject(t)}let r=await fetch(e);if(r.ok){let i=await r.arrayBuffer(),a="";if(e.match(/\.glb(\?|#|$)/i)&&"glTF"===String.fromCharCode.apply(null,new Uint8Array(i,0,4)))a="Pbr";else{if(!e.match(/\.fbx(\?|#|$)/i)||"Kaydara FBX Binary  \0\0"!==String.fromCharCode.apply(null,new Uint8Array(i,0,23))){let t=new Error(`Invalid model file: ${e}. Only FBX and GLB are supported at the moment.`);return Promise.reject(t)}a="UnlitTextured"}let o=mlWorld[0].createModelResource(i);return t._kmat&&(o.kmat=t._kmat),o?{resource:o,shader:a}:Promise.reject(new Error(`Load resource failed: ${e}`))}return Promise.reject(new Error(`Load resource failed: ${e}`))})(t,t.getAttribute("src"));return D(t,e)},V=(t,e)=>{let r={resource:e._resource,shader:e._model.shader};D(t,r)},U=t=>{void 0===t._scrollListener&&(t._scrollListener=G.bind(t),window.addEventListener("scroll",t._scrollListener))},X=t=>{t._scrollListener&&(window.removeEventListener("scroll",t._scrollListener),delete t._scrollListener)};function G(){O(this)}let K=t=>{void 0===t._resizeObserver&&(t._resizeObserver=new ResizeObserver(t=>{t.forEach(t=>{$(t.target)})}),t._resizeObserver.observe(t))},Z=t=>{void 0===t._resizeListener&&(t._resizeListener=Y.bind(t),window.addEventListener("resize",t._resizeListener))},Q=t=>{t._resizeListener&&(window.removeEventListener("resize",t._resizeListener),delete t._resizeListener)};function Y(){O(this)}let J=t=>{void 0===t._stageChangeListener&&(t._stageChangeListener=et.bind(t),document.addEventListener("mlstage",t._stageChangeListener))},tt=t=>{t._stageChangeListener&&(document.removeEventListener("mlstage",t._stageChangeListener),delete t._stageChangeListener)};function et(){O(this)}let rt=(t,e=.1)=>{let r=t._model?t._model:t._quad;if(!r)return;let i=1,a=1,o=r.backfaceVisibility;if(r.backfaceVisibility=!1,"#"==r.color.charAt(0)&&7===r.color.length&&(r.color=r.color+"FE"),r.visible&&"#"!==r.color.charAt(0)){let s=r.color.match(/[+-]?\d+(\.\d+)?/g);parseFloat(s[3])>0&&(a=parseFloat(s[3]),i=a),function n(){i-=e,parseFloat(i)<0?(t.visibility="hidden",s[3]=a,r.color=`rgba(${s.join(", ")})`,void 0!==r.isOpaque&&(r.isOpaque=!0),r.backfaceVisibility=o):(s[3]=i,r.color=`rgba(${s.join(", ")})`,setTimeout(n,16))}()}},it=(t,e=.1)=>{let r=t._model?t._model:t._quad;if(!r)return;let i=0,a=1,o=r.backfaceVisibility;if(r.backfaceVisibility=!1,"#"==r.color.charAt(0)&&7===r.color.length&&(r.color=r.color+"00"),"#"!==r.color.charAt(0)){let s=r.color.match(/[+-]?\d+(\.\d+)?/g);parseFloat(s[3])>0&&(a=parseFloat(s[3])),s[3]=0,r.color=`rgba(${s.join(", ")})`,t.visibility="visible",function t(){i+=e,parseFloat(i)>a?(s[3]=a,r.color=`rgba(${s.join(", ")})`,void 0!==r.isOpaque&&a>=1&&(r.isOpaque=!0),r.backfaceVisibility=o):(s[3]=i,r.color=`rgba(${s.join(", ")})`,setTimeout(t,16))}()}},at=(t,e=[0,1,0])=>{t._transform&&(t._transform.rotateBy(new Float32Array(e),.07,.1,0),t._transform.rotateBy(new Float32Array(e),-.07,.1,0),t._transform.rotateBy(new Float32Array(e),-.07,.1,0),t._transform.rotateBy(new Float32Array(e),.07,.1,0))};class ot extends HTMLElement{constructor(){super(),this.addEventListener("error",(function(t){!this._model&&this.hasAttribute("alt-img")&&(this.style.setProperty("background-image","url("+this.getAttribute("alt-img")+")"),this.style.setProperty("background-repeat","no-repeat"),this.style.setProperty("background-size","100%"))}),!0)}connectedCallback(){window.mlWorld?(this.style.display||(this.style.display="inline-block"),this.extractable&&(N(this),F(this)),I(this),K(this),Z(this),J(this),U(this)):this.dispatchEvent(new ErrorEvent("error",{error:new Error("Unable to render 3D content on this device."),message:"No mixed-reality browser detected.",bubbles:!0}))}render(){this.src&&window.mlWorld&&(0===mlWorld.length&&(window.mlWorld.resetStageExtent(),e(this)),this.doRendering().then(()=>{if(this._model.visible=n(this)&&!("hidden"===this.visibility),this.id){document.querySelectorAll(`ml-model[instance=${this.id}]`).forEach(t=>{V(t,this),t._model&&(t._model.visible=n(t)&&!("hidden"===t.getAttribute("visibility")))})}}).catch(t=>{this.dispatchEvent(new ErrorEvent("error",{error:t,message:t.message||"Problem rendering node",bubbles:!0})),console.error(`Problem rendering: ${t}`)}))}doRendering(){return j(this)}static get observedAttributes(){return["extractable","breadth","materials","color","visibility","raycast","rotation","rotate-to-angles","rotate-by-angles","model-animation","model-animation-speed","spin","model-scale","scale","scale-to","scale-by","extracted-scale","extracted-size","extracted-link","move-to","move-by","src","z-offset","environment-lighting"]}attributeChangedCallback(t,e,r){"src"===t?this.render():window.mlWorld&&mlWorld[0]&&this._model&&R(this,{[t]:r})}disconnectedCallback(){this._model&&(this._transform.removeChild(this._model),this._mainTransform.removeChild(this._transform),mlWorld[0].removeChild(this._mainTransform)),this._model=null,this._mainTransform=null,this._transform=null,this._resource=null,this._textures=null,this._kmat=null,X(this),Q(this),tt(this)}get extractable(){return this.hasAttribute("extractable")&&(""===this.getAttribute("extractable")||"true"===this.getAttribute("extractable"))}set extractable(t){this.getAttribute("extractable")!==t.toString()&&this.setAttribute("extractable",t.toString())}get fill(){return this.hasAttribute("fill")&&(""===this.getAttribute("fill")||"true"===this.getAttribute("fill"))}set fill(t){this.getAttribute("fill")!==t.toString()&&this.setAttribute("fill",t.toString())}get breadth(){return s(this.getAttribute("breadth"))}set breadth(t){isNaN(parseFloat(t))||this.setAttribute("breadth",t.toString())}get materials(){return this.getAttribute("materials")}set materials(t){this.getAttribute("materials")!==t.toString()&&this.setAttribute("materials",t)}get color(){return this.getAttribute("color")}set color(t){this.getAttribute("color")!==t.toString()&&this.setAttribute("color",t)}get visibility(){return this.getAttribute("visibility")}set visibility(t){this.getAttribute("visibility")!==t.toString()&&this.setAttribute("visibility",t)}get raycast(){return!("false"===this.getAttribute("raycast"))}set raycast(t){this.getAttribute("raycast")!==t.toString()&&this.setAttribute("raycast",t.toString())}get rotation(){return this.getAttribute("rotation")}set rotation(t){this.setAttribute("rotation",t)}get rotateToAngles(){return this.getAttribute("rotate-to-angles")}set rotateToAngles(t){this.setAttribute("rotate-to-angles",t)}get rotateByAngles(){return this.getAttribute("rotate-by-angles")}set rotateByAngles(t){this.setAttribute("rotate-by-angles",t)}get animation(){return this.getAttribute("model-animation")}set animation(t){this.setAttribute("model-animation",t)}get animationSpeed(){return parseFloat(this.getAttribute("model-animation-speed"))}set animationSpeed(t){this.getAttribute("model-animation-speed")!==t.toString()&&(isNaN(parseFloat(t))||this.setAttribute("model-animation-speed",parseFloat(t)))}get spin(){return this.getAttribute("spin")}set spin(t){this.setAttribute("spin",t)}get modelScale(){return this.getAttribute("model-scale")}set modelScale(t){this.setAttribute("model-scale",t)}get scale(){return this.getAttribute("scale")}set scale(t){this.setAttribute("scale",t)}get scaleTo(){return this.getAttribute("scale-to")}set scaleTo(t){this.setAttribute("scale-to",t)}get scaleBy(){return this.getAttribute("scale-by")}set scaleBy(t){this.setAttribute("scale-by",t)}get extractedScale(){return parseFloat(this.getAttribute("extracted-scale"))}set extractedScale(t){this.getAttribute("extracted-scale")!==t.toString()&&(isNaN(parseFloat(t))||this.setAttribute("extracted-scale",parseFloat(t)))}get extractedSize(){return this.getAttribute("extracted-size")}set extractedSize(t){this.getAttribute("extracted-size")!==t.toString()&&this.setAttribute("extracted-size",t)}get extractedLink(){return this.getAttribute("extracted-link")}set extractedLink(t){this.getAttribute("extracted-link")!==t.toString()&&this.setAttribute("extracted-link",t)}get moveTo(){return this.getAttribute("move-to")}set moveTo(t){this.setAttribute("move-to",t)}get moveBy(){return this.getAttribute("move-by")}set moveBy(t){this.setAttribute("move-by",t)}get src(){return this.getAttribute("src")}set src(t){this.getAttribute("src")!==t.toString()&&this.setAttribute("src",t)}get zOffset(){return this.hasAttribute("z-offset")&&!isNaN(parseFloat(this.getAttribute("z-offset")))?s(this.getAttribute("z-offset")):r}set zOffset(t){isNaN(parseFloat(t))||this.setAttribute("z-offset",t.toString())}get environmentLighting(){return this.getAttribute("environment-lighting")}set environmentLighting(t){this.setAttribute("environment-lighting",t)}stopTransformAnimations(){this._transform&&this._transform.stopTransformAnimations()}stopModelAnimation(){this._model&&(this._model.paused=!0)}fadeOut(t){rt(this,t)}fadeIn(t){it(this,t)}wiggle(t){at(this,t)}}window.customElements.define("ml-model",ot);let st=(t,e)=>{let r=mlWorld[0],i=t._quad;if(e.extractable&&("false"!==e.extractable?(N(t),F(t)):(M(t),k(t))),i){if(e.color)i.color=e.color;else if(""===e.color){new RegExp(/(\.png(\?|#|$))|^(data:image\/png;base64,*)/i).test(t.src)?i.color="rgba(255, 255, 255, 0.99)":i.color="#FFFFFF"}if(e["environment-lighting"]){let t=B(e["environment-lighting"]);t["color-intensity"]&&(i.colorIntensity=t["color-intensity"]),t["bloom-strength"]&&(i.bloomStrength=t["bloom-strength"],r.bloomStrength=t["bloom-strength"])}e.raycast&&l(i,!("true"===e.raycast)),e.visibility&&(i.visible=n(t)&&!("hidden"===e.visibility)),e["quad-scale"]&&(d(t,e["quad-scale"]),H(t)),e.scale&&(d(t,e.scale),H(t)),e.rotation&&m(t,e.rotation),e.spin&&g(t,e.spin),e["scale-to"]&&(b(t,e["scale-to"]),H(t)),e["scale-by"]&&(f(t,e["scale-by"]),H(t)),e["move-to"]&&(A(t,e["move-to"]),H(t)),e["move-by"]&&(x(t,e["move-by"]),H(t)),e["rotate-to-angles"]&&E(t,e["rotate-to-angles"]),e["rotate-by-angles"]&&S(t,e["rotate-by-angles"]),(e.breadth||e["z-offset"])&&($(t),O(t))}},nt=(t,e)=>{let r=mlWorld[0];t._quad||(t._quad=r.createQuad(),t._quad.visible=!1,t._quad.htmlElement=t),t._quad.triggerable=!0,t._quad.setRenderResource(e),new RegExp(/(\.png(\?|#|$))|^(data:image\/png;base64,*)/i).test(t.src)&&(t._quad.color="rgba(255, 255, 255, 0.99)"),t.dispatchEvent(new Event("resource-loaded")),t._transform||(t._transform=r.createTransform(),t._transform.htmlElement=t,t._transform.addChild(t._quad),t._mainTransform=r.createTransform(),t._mainTransform.addChild(t._transform),r.addChild(t._mainTransform)),$(t),O(t);let i={trigger:t.getAttribute("trigger"),color:t.getAttribute("color"),raycast:t.getAttribute("raycast"),"quad-scale":t.getAttribute("quad-scale"),scale:t.getAttribute("scale"),rotation:t.getAttribute("rotation"),"rotate-to-angles":t.getAttribute("rotate-to-angles"),"rotate-by-angles":t.getAttribute("rotate-by-angles"),spin:t.getAttribute("spin"),"scale-to":t.getAttribute("scale-to"),"scale-by":t.getAttribute("scale-by"),"move-to":t.getAttribute("move-to"),"move-by":t.getAttribute("move-by"),"environment-lighting":t.getAttribute("environment-lighting")};st(t,i),window.mlWorld.update(),t.dispatchEvent(new Event("quad-displayed"))},lt=async t=>(t._texture=await(t=>{if(!new RegExp(/(\.(jpg|jpeg|png)(\?|#|$))|^(data:image\/(jpg|jpeg|png);base64,*)/i).test(t)){let e=new Error(`Invalid quad image file type: ${t}. Only JPG and PNG are supported at the moment for quads.`);return Promise.reject(e)}return new Promise((e,r)=>{let i=new Image;i.onload=()=>{let a=mlWorld[0].createTexture(i);a?e(a):r(new Error(`Problem loading quad texture: ${t}.`))},i.onerror=()=>{r(new Error(`Problem loading quad texture: ${t}.`))},i.src=t})})(t.getAttribute("src")),t.dispatchEvent(new Event("quad-readytoload")),nt(t,t._texture)),dt=(t,e)=>{nt(t,e._texture)};class ct extends HTMLElement{constructor(){super(),this.addEventListener("error",(function(t){!this._quad&&this.hasAttribute("alt-img")&&(this.style.setProperty("background-image","url("+this.getAttribute("alt-img")+")"),this.style.setProperty("background-repeat","no-repeat"),this.style.setProperty("background-size","100%"))}),!0)}connectedCallback(){window.mlWorld?(this.style.display||(this.style.display="inline-block"),this.extractable&&(N(this),F(this)),I(this),K(this),Z(this),J(this),U(this)):this.dispatchEvent(new ErrorEvent("error",{error:new Error("Unable to render 3D content on this device."),message:"No mixed-reality browser detected.",bubbles:!0}))}render(){this.src&&(0===mlWorld.length&&(window.mlWorld.resetStageExtent(),e(this)),this.doRendering().then(()=>{if(this._quad.visible=n(this)&&!("hidden"===this.visibility),this.id){document.querySelectorAll(`ml-quad[instance=${this.id}]`).forEach(t=>{dt(t,this),t._quad&&(t._quad.visible=n(t)&&!("hidden"===t.getAttribute("visibility")))})}}).catch(t=>{this.dispatchEvent(new ErrorEvent("error",{error:t,message:t.message||"Problem rendering node",bubbles:!0})),console.error(`Problem rendering: ${t}`)}))}doRendering(){return lt(this)}static get observedAttributes(){return["extractable","breadth","color","visibility","raycast","rotation","rotate-to-angles","rotate-by-angles","spin","quad-scale","scale","scale-to","scale-by","extracted-scale","extracted-size","extracted-link","move-to","move-by","src","z-offset"]}attributeChangedCallback(t,e,r){"src"===t?this.render():mlWorld[0]&&this._quad&&st(this,{[t]:r})}disconnectedCallback(){this._quad&&(this._transform.removeChild(this._quad),this._mainTransform.removeChild(this._transform),mlWorld[0].removeChild(this._mainTransform)),this._quad=null,this._texture=null,this._mainTransform=null,this._transform=null,X(this),Q(this),tt(this)}get extractable(){return this.hasAttribute("extractable")&&(""===this.getAttribute("extractable")||"true"===this.getAttribute("extractable"))}set extractable(t){this.getAttribute("extractable")!==t.toString()&&this.setAttribute("extractable",t.toString())}get breadth(){return s(this.getAttribute("breadth"))}set breadth(t){isNaN(parseFloat(t))||this.setAttribute("breadth",t.toString())}get color(){return this.getAttribute("color")}set color(t){this.getAttribute("color")!==t.toString()&&this.setAttribute("color",t)}get visibility(){return this.getAttribute("visibility")}set visibility(t){this.getAttribute("visibility")!==t.toString()&&this.setAttribute("visibility",t)}get raycast(){return!("false"===this.getAttribute("raycast"))}set raycast(t){this.getAttribute("raycast")!==t.toString()&&this.setAttribute("raycast",t.toString())}get rotation(){return this.getAttribute("rotation")}set rotation(t){this.setAttribute("rotation",t)}get rotateToAngles(){return this.getAttribute("rotate-to-angles")}set rotateToAngles(t){this.setAttribute("rotate-to-angles",t)}get rotateByAngles(){return this.getAttribute("rotate-by-angles")}set rotateByAngles(t){this.setAttribute("rotate-by-angles",t)}get spin(){return this.getAttribute("spin")}set spin(t){this.setAttribute("spin",t)}get quadScale(){return this.getAttribute("quad-scale")}set quadScale(t){this.setAttribute("quad-scale",t)}get scale(){return this.getAttribute("scale")}set scale(t){this.setAttribute("scale",t)}get scaleTo(){return this.getAttribute("scale-to")}set scaleTo(t){this.setAttribute("scale-to",t)}get scaleBy(){return this.getAttribute("scale-by")}set scaleBy(t){this.setAttribute("scale-by",t)}get extractedScale(){return parseFloat(this.getAttribute("extracted-scale"))}set extractedScale(t){this.getAttribute("extracted-scale")!==t.toString()&&(isNaN(parseFloat(t))||this.setAttribute("extracted-scale",parseFloat(t)))}get extractedSize(){return this.getAttribute("extracted-size")}set extractedSize(t){this.getAttribute("extracted-size")!==t.toString()&&this.setAttribute("extracted-size",t)}get extractedLink(){return this.getAttribute("extracted-link")}set extractedLink(t){this.getAttribute("extracted-link")!==t.toString()&&this.setAttribute("extracted-link",t)}get moveTo(){return this.getAttribute("move-to")}set moveTo(t){this.setAttribute("move-to",t)}get moveBy(){return this.getAttribute("move-by")}set moveBy(t){this.setAttribute("move-by",t)}get src(){return this.getAttribute("src")}set src(t){this.getAttribute("src")!==t.toString()&&this.setAttribute("src",t)}get zOffset(){return this.hasAttribute("z-offset")&&!isNaN(parseFloat(this.getAttribute("z-offset")))?s(this.getAttribute("z-offset")):r}set zOffset(t){isNaN(parseFloat(t))||this.setAttribute("z-offset",t.toString())}stopTransformAnimations(){this._transform&&this._transform.stopTransformAnimations()}fadeOut(t){rt(this,t)}fadeIn(t){it(this,t)}wiggle(t){at(this,t)}}window.customElements.define("ml-quad",ct);let mt=()=>{if(mlWorld.length>0){let t=mlWorld[0],e=new DOMMatrix;if("flat"===window.mlWorld.orientation)e=(e=e.translate((window.mlWorld.stageExtent.right-window.mlWorld.stageExtent.left)/2,window.mlWorld.viewPortPositionTopLeft.y+(window.mlWorld.stageExtent.front-window.mlWorld.stageExtent.back)/2,(window.mlWorld.stageExtent.bottom-window.mlWorld.stageExtent.top)/2)).rotateAxisAngle(1,0,0,-90);else{const t=window.mlWorld.viewportHeight/2+window.mlWorld.viewPortPositionTopLeft.y;e=(e=e.translate((window.mlWorld.stageExtent.right-window.mlWorld.stageExtent.left)/2,t+(window.mlWorld.stageExtent.top-window.mlWorld.stageExtent.bottom)/2,(window.mlWorld.stageExtent.front-window.mlWorld.stageExtent.back)/2)).rotateAxisAngle(1,0,0,0)}t.transformVolumeRelativeToHostVolume(e),t.setSize(window.mlWorld.stageSize.x,window.mlWorld.stageSize.y,window.mlWorld.stageSize.z)}};
/*!
   * @license
   * Copyright (c) 2018-present Magic Leap, Inc. All Rights Reserved.
   * Distributed under Apache 2.0 License. See LICENSE file in the project root directory for full license information.
   */window.mlWorld?(document.addEventListener("mlstage",mt),document.addEventListener("mlpageorientation",mt),setInterval(()=>window.mlWorld.update(),16)):console.warn("Unable to render content: No mixed-reality browser detected."),t.MlModel=ot,t.MlQuad=ct,t.MlStage=o,Object.defineProperty(t,"__esModule",{value:!0})}));
